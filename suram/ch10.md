## 10장. 

> section 1. 절차적 함수 호출 지원 CPU 모델

### Stack Frame

- 함수 내에 선언된 변수는 스택에 할당됨. 함수 호출 과정에서 할당되는 메모리 블록(지역 변수로 인해 할당됨)을 스택 프레임이라 한다.
- 호출된 함수가 반환되면 해당 스택 프레임도 모두 반환된다.
- 함수 호출이란?
    - 인자
    - **지역변수**
    - 실행 이동

1. sp register

메모리의 구조적 특성 : 스택 = LIFO 계속해서 스택에 데이터를 쌓기 위해서는 어느 위치까지 데이터를 저장했는지 기억해야만 한다. sp 레지스터는 변수가 하나씩 할당될 때마다 위치를 기억함. 함수가 종료될 경우, 스택 프레임 단위로 sp 레지스터값이 이동됨. (그 안에 할당된 변수들을 모두 반환해야 하기 때문)

- 그러나 함수 종료시 얼마만큼 sp 레지스터를 이동해야 하는가? = 하나의 함수에 얼마 만큼의 메모리 공간을 할당했는가.
- 따라서 이를위한 장치가 필요함.

1. Frame Pointer register

별도의 레지스터를 추가하는 방법. 

`목표` : sp 레지스터의 위치를 함수 호출 이전으로 어떻게 되돌릴 것인가?

`대안` : 변수가 할당될 때마다 해당 크기만큼 값을 증가시킨다.

- 스택 연산에 드는 비용이 늘어난다.

`해결` : fp 레지스터에 되돌아갈 sp의 위치를 저장

- 함수를 중첩으로 호출하고 있는 경우 문제가 발생 : 이전의 fp 레지스터 값을 덮어쓰는 경우.

1. 스택에 저장하자 fp 

함수 호출이 일어날 때마다 fp의 현재 위치를 계속 스택에 저장한다. 그러면 이전의 위치들을 계속 참조할 수 있다. 

> section2. 함수 호출 인자의 전달과 PUSH & POP 명령어 디자인

- 함수 호출
    - **인자 전달** : 전달되는 인자도 스택에 쌓임. 지역 변수와 lifecycle이 동일함. 스택에 저장하는 일이 매우 빈번하게 발생함. 스택에 매우 많은 연산이 일어남. 스택에 데이터를 넣고 push 빼는 pop 연산의 디자인을 생각해봐야 함.
    - 지역 변수
    - 실행 이동

### 함수 호출 인자의 전달방식

전달 인자도 스택에 저장

### PUSH&POP 명령어 디자인

```jsx
STORE 7, sp
```

7을 sp에 저장하라. 그러나 STORE 명령어는 `STORE (레지스터), (레지스터)` 형식을 갖기 때문에 7을 레지스터에 저장하고 sp를 메모리에 저장해야 한다. 

- Add r1, 7, 0 : 7 + 0 연산을 하여 r1 레지스터에 저장한다
- Store sp, 0x40 : sp 레지스터를 0x40 메모리에 저장한다
- Store r1, 0x40 : 최종 명령어
