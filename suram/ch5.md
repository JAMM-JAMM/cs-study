# 프로세스의 생성과 소멸 

### Section1. 프로세스의 이해

> 프로세스의 정의

메인 메모리에 옮겨져 실행 중인 프로그램. 프로그램은 하드 디스크에 저장되어 있는 바이너리 코드. 이 코드들이 메인 메모리와 CPU에 옮겨져 실행되는 것이다. 이때의 상태를 프로세스라 부른다. 

> 프로세스 구성 요소

1. 메모리 구조를 알아야 함. 메인 메모리에 프로그램 코드가 올라와 있을 때의 상태가 프로세스의 실체이다. 메인 메모리의 구조 = 프로세스

    ![https://notes.shichao.io/tlpi/figure_6-1.png](https://notes.shichao.io/tlpi/figure_6-1.png)

    - Data 영역 : 전역변수나 static 변수가 할당되는 영역
    - Stack 영역 : 지역변수나 함수의 인자값들이 저장되는 영역
    - Heap 영역 : 동적 할당 = 프로그래머 할당
    - Code 영역 : 프로그램의 바이너리 코드가 저장되는 영역 = 명령어들이 올라감

    프로그램이 실행되면 위와 같은 구조로 메모리를 할당받고 이러한 구조는 실행되는 프로그램의 개수만큼 생성된다. 

     * RAM의 크기에 제한적일 수 있는데 이는 가상 메모리 관리로 개선된다. 

2. CPU의 Register들 까지도 프로세스에 포함된다. 실행되는 프로그램의 상태가 프로세스의 정의이기 때문에 레지스터들은 해당 프로그램에 대한 정보들로 채워지게 될 것이기 때문이다. ↔ 컨텍스트 스위칭. 

### Section2. 프로세스의 스케줄링과 상태 변화

기본적으로 CPU는 한 순간에 하나의 프로그램만 실행 가능. 어떻게 여러 개의 프로그램을 동시에 실행시킬 수 있을까? → `스케줄링`, `멀티 프로세싱` 

> 프로세스의 스케줄링

하나의 CPU가 여러 개의 프로세스를 번갈아 가면서 실행한다. 운영체제에서 여러 개의 프로그램들의 CPU 할당 시간을 정해준다. 

여러 개의 프로그램을 동시에 (=번갈아 가면서 빠르게) CPU에게 할당시키려면 할당 시키는 기준이 필요하다. 

- 스케줄링 : 프로세스의 CPU 할당 순서 및 방법을 결정짓는 작업
- 스케줄링 알고리즘 : 결정짓는 여러 가지 방법들
- 스케줄러 : 실제로 프로세스를 관리하는 운영체제 장치 = (소프트웨어)

I/O에 생각보다 많은 시간들을 소비하게 된다. 프로세스에서 입/출력이 발생되어 관련된 일을 할 동안 CPU는 아무 일도 하지 않고 대기하고 있다. → 비효율적. 따라서 프로세스에 입/출력이 발생하면 해당 프로세스를 내리고 다른 프로세스를 실행하도록 한다. 

![https://blog.kakaocdn.net/dn/B9Ey1/btqK16JaCpe/3k7MGh0oPiE6aX90gWTpo0/img.png](https://blog.kakaocdn.net/dn/B9Ey1/btqK16JaCpe/3k7MGh0oPiE6aX90gWTpo0/img.png)

프로세스 상태

- `new`  : 프로세스가 새로 생성됨.
- `ready` : CPU에 의해 실행되기를 기다리는 상태. 스케줄러에 의해 선택된 프로세스가 running 상태로 바뀐다.
- `running` : CPU를 할당받아 실행되는 상태
- `waiting` : 프로세스에 입/출력이 발생하면 대기 상태로 들어가고 입/출력이 완료될 때까지 기다리는 상태. 입출력이 모두 끝나면 다시 ready 상태로 들어간 후 실행을 기다린다.

우선순위
프로세스들 사이에서 우선순위라는 개념이 있다. 현재 실행 중인 프로세스보다 더 높은 우선순위의 프로세스가 생성/대기 상태에 있다면 기존 프로세스를 ready 상태로 옮기고 더 높은 우선순위의 프로세스를 실행한다. (상태변화 : running → ready) 양보의 느낌. 

Ready ≠ Waiting

- Running → Ready는 아직도 해야 할 일이 있음에도 다른 프로세스에게 CPU를 양보한다. 스케줄러의 대상이 되며 언제라도 다시 실행될 수 있다. 
- Running → Waiting은 CPU 연산이 필요하지 않은 입/출력 결과를 기다리는 상태이고, 스케줄러의 대상이 아니며, 입/출력 연산이 끝나면 Ready 상태로 들어간다.  

### Section3. 컨텍스트 스위칭

프로세스의 상태 변경은 멀티 프로세싱의 장점도 있지만 **많은 비용도 든다**.  여러 프로세스들을 CPU에 할당하려면 CPU 내의 레지스터들의 값도 변경 및 저장해줘야 한다. A 프로세스에서 B 프로세스로 변경하려고 하는 경우 기존 A 실행에 관한 정보들 (레지스터)을 메모리에 저장해놓아야 다시 A가 실행되었을 때 이어서 작업할 수 있기 때문이다. 이러한 전환 작업을 컨텍스트 스위칭이라 한다. 

- `컨텍스트 스위칭` : 현재 프로세스의 상태 및 작업 정보를 저장하고, 실행될 프로세스의 정보들을 로드하는 과정

멀티 프로세싱 - 컨텍스트 스위칭 비용을 잘 고려해야 한다. 멀티 프로세싱 정도가 높아지만 그만큼 컨텍스트 스위칭 비용도 늘어나게 되어 시스템에 부하가 될 수 있기 때문이다.
