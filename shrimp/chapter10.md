### 스택 프레임 (Stack Frame)

- 임의의 함수 내에서 선언된 메모리 공간
- 메인함수의 데이터 블럭

**Stack Frame Register** : 스택 프레임의 top 위치, 어디까지 메모리를 할당했는지 기억하는 레지스터

**Frame Pointer Register** : 함수 호출 후 반환 주소를 기억하는 레지스터

**함수 호출 반환**

- 스택 포인터의 위치를 함수 호출 이전으로 옮기고 새로 호출하면 메모리에 데이터가 덮어씌워짐

**함수가 연쇄적으로 호출될 경우**

- 프레임 포인터 레지스터는 연쇄적으로 반환 주소를 저장
- 저장해야 하는 반환 주소가 많아 스택에 저장



### 함수 호출 인자의 전달 방식

전달되는 인자도 지역변수처럼 Stack에 적재

#### PUSH

- 인자값들을 STORE 명령어를 통해 바로 스택 포인터가 가르키는 메모리를 넣을 수 없음

- 해결방법

  ```ㅇ
  ADD r1, 7, 0 // 인자값을 레지스터에 저장
  STORE sp, 0x40 // 스택 포인터가 가지고 있는 메모리 정보를 임의의 메모리 공간에 저장
  STORE r1, [0x40] // r1에 있는 정보를 저장
  ADD sp, sp, 4 // 스택 포인터의 주소값을 증가
  ```

#### POP

- ADD나 SUB를 활용한 인자값 호출

  ```ㅇ
  ADD sp, sp, -(스택 프레임 크기)
  SUB sp, sp, (스택 프레임 크기)
  ```



### 호출 규약과 실행의 이동

#### Program Counter

- 스택 프레임 레지스터와 유사한 역할 수행
- 프로그램이 순차적으로 실행되도록 값을 기억하는 역할
- 함수 내에서 다른 함수 호출 시 함수에서 함수로 실행을 이동시키기 위해 필요

**링크 레지스터 (Link Register)**

- 프레임 포인터 레지스터와 유사한 역할 수행
- 프로그램 카운터가 갖고 있던 이전 상태를 저장
- Stack 메모리를 활용하여 이전 상태들을 저장

#### **함수 호출 규약**

- 어떻게 함수 호출을 정의할 것인지 실행할 것인지 결정 요소
- 반환 작업을 어떤 함수에 넣을지 결정
- 두 함수가 있다면 하나의 함수만
- 함수가 인자를 전달할 때 어디부터 전달하고 어디부터 채우는 지 맞춰야함
- Stack 공간을 청소하는 주체를 지정
- Stack 방향 지정 (C Style 등)
- 32bit보다 64bit가 매개변수를 저장하는 레지스터를 많이 사용하여 더 빠른 속도 보유
